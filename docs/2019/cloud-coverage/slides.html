<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>reveal-md</title>
    <meta property="og:title" content="reveal-md" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://matthewhanson.github.io/presentations/2019/featured-slide.jpg" />
    <meta property="og:url" content="https://matthewhanson.github.io/presentations/2019" />
    <link rel="stylesheet" href="./../css/reveal.css" />
    <link rel="stylesheet" href="./../css/theme/solarized.css" id="theme" />
    <link rel="stylesheet" href="./../css/highlight/zenburn.css" />
    <link rel="stylesheet" href="./../css/print/paper.css" type="text/css" media="print" />
    <link rel="stylesheet" href="./../_assets/style.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template"><div>How cloudy is London really?</div>
<hr />
<div>
    <div style="text-align: right; font-size: 80%">
        Matthew Hanson<br />
        @geoskeptic
    </div>
</div>
</script></section><section ><section data-markdown><script type="text/template">
## Introduction

- New Hampshire - Live Free or Die!
- 2 teenage daughters
- Like snow
- circa 1985
  - Photography > Imaging Science > Remote sensing
- Open-source geospatial software
</script></section><section data-markdown><script type="text/template">
### Recent work

- Cumulus: Dockerization of algorithms
- Land cover classification and mapping: Malawi, Ethiopia, Kenya
- Monitoring special economic zones with Digital Globe imagery and VIIRS nightlights
- MODIS Public dataset
- Contributor to development of STAC specification
- sat-utils: OS tools for search and access of imagery
- Landsat and Sentinel catalogs
- Coastline mapping and conflation (Landsat, Sentinel, Planet)
</script></section></section><section ><section data-markdown><script type="text/template">
## The Project

- Pick NASA Earthdata dataset (of 5k!) and tell a story
- Initial ideas
    - Do something different than imagery
    - Arctic ground samples measuring permafrost
    - LiDAR and birds
- Most datasets are single campaign in support specific science research
    - I wanted to tell a story over time
- So, back to imagery
</script></section><section data-markdown><script type="text/template">
### MODIS

- I :heart: MODIS
- Science!
- It really is a gold standard: [MCD43A4](https://lpdaac.usgs.gov/dataset_discovery/modis/modis_products_table/mcd43a4_v006)
- [MODIS Land products](https://lpdaac.usgs.gov/dataset_discovery/modis/modis_products_table)
- [MODIS Atmosphere products](https://modis-atmos.gsfc.nasa.gov/products/)
</script></section><section data-markdown><script type="text/template">
### Remote Sensing

-----
Adage #2

Remote Sensing loves The Cloud

-----
Adage #3

Remote Sensing hates clouds

-----
</script></section></section><section ><section data-markdown><script type="text/template">
### Clouds: An eternal problem

- Cloud detection algorithms
    - range from terrible to not-that-great
    - Fmask, ACCA for Landsat
    - Sentinel-2 masks terrible (no thermal bands)
- 50% cloud cover does NOT = 50% usable pixels
    - Shadows, Point Spread Function, haze/mist, or otherwise compromised pixels
    - 50% cloud cover often = 0% usable pixels
</script></section><section data-markdown><script type="text/template">
### Handling clouds

- The "Cloud-Free Image" Approach
- Time series, using all valid pixels

</script></section><section data-markdown><script type="text/template">
### Cloud questions

1. Relative cloudiness
    - How cloudy is this place compared to that place?
2. When am I more likely to get a cloud-free image?
    - What seasons?
    - When should I task a satellite, or fly a drone?
3. How many valid observations can I expect over time?
    - I know temporal frequency of my sat
    - For a pixel, how many observations can I expect?

-----

<div class="fragment" style="font-size: 70%">
Spoiler:
- #1 has been answered by others, I didn't answer #2 or #3
</div>
</script></section><section data-markdown><script type="text/template">
### Global Cloud Map

- [Global map of average cloud cover 2002-2015](https://www.vox.com/2015/5/11/8585439/cloud-map-global)
- [Images of monthly averages](http://eclipsophile.com/global-cloud-cover/)
- [Monthly averages and variability over 15 years](https://www.earthenv.org/cloud)

-----

- Above all based on MODIS
- Average as a metric isn't whole story
- But how often I can get a cloud-free image?
</script></section><section data-markdown><script type="text/template">
### Cloud Products

[MODIS Standard Atmosphere Products](https://modis-atmosphere.gsfc.nasa.gov/products)

- MOD06_L2 - 250 subdatasets of cloud metrics
- MOD35_L2 - masks of cloud types

- Derived cloud masks from Land products?
    - Cloud cover properites of MODIS daily images?
    - QC band for MCD products, using 16 day window?
</script></section></section><section ><section data-markdown><script type="text/template">
## Python Backend Library

- Query CMR for MOD35 scenes within `geometry` from `start_date` to `end_date`
- Download HDF file
- Extract Cloud Mask subdataset from HDF
- Reproject to lat/lon
- Extract cloud mask from bitmask, save as COG
- Clip byte mask by AOI
- Calculate cloud percentage as
    - (# of cloudy pixels / # of valid pixels)
    - Valid pixels from nodata mask
</script></section><section data-markdown><script type="text/template">
### Command Line Interface (CLI)

```
usage: modis_clouds.py [-h] [--version] [--log LOG] [--start START]
                       [--end END] [--datadir DATADIR] [--process] [--vis]
                       [--night]
                       intersects

MODIS Cloud Processing (v0.1.0)

positional arguments:
  intersects         GeoJSON Feature to search against

optional arguments:
  -h, --help         show this help message and exit
  --version          Print version and exit
  --log LOG          0:all, 1:debug, 2:info, 3:warning, 4:error, 5:critical
                     (default: 2)
  --start START      Starting date (default: 2019-01-01)
  --end END          Ending date (default: 2019-02-27)
  --datadir DATADIR  Save to this directory (default: data)
  --process          Convert cloud mask to COG (default: False)
  --vis              Download visible daily imagery too (default: False)
  --night            Also download night scenes (default: False)
```
</script></section><section data-markdown><script type="text/template">
### Sanity checks with QGIS

- Reprojection of HDF subdatasets
    - Atmosphere products use geolocation arrays
- Does the cloud mask match up with optical scenes?
</script></section></section><section ><section data-markdown><script type="text/template">
### Analysis

- Jupyter notebook
- Read CSV data from backend, explore with plots
</script></section><section data-markdown><script type="text/template">
### Poor assumptions

- Assumes pixel area doesn't vary much over an AOI
    - using lat/lon projection
    - Not equal area
    - Reproject to an equal area projection using center lat/lon of AOI
        - Or UTM, which is close enough to equal area
- Compare AOIs of equal areas
- Ignores incomplete AOIs (AOI on tile edge)
</script></section><section data-markdown><script type="text/template">
### Further directions and questions

- Likelihoods, not averages
- Nighttime vs Daytime
    - Algorithms are different
    - How do cloud masks compare, on average?
    - Over or underestimated during day or night?
- MODIS Aqua!
- VIIRS!!
- Look at high probability clouds only
- Examine seasonal variations using Fourier Analysis
- Predictive model
    - Predictive cloud cover for any given day of year
</script></section><section data-markdown><script type="text/template">
### Questions ?

---</script></section></section></div>
    </div>

    <script src="./../lib/js/head.min.js"></script>
    <script src="./../js/reveal.js"></script>

    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // Optional libraries used to extend on reveal.js
      var deps = [
        { src: './../lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: './../plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
        { src: './../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: './../plugin/zoom-js/zoom.js', async: true },
        { src: './../plugin/notes/notes.js', async: true },
        { src: './../plugin/math/math.js', async: true }
      ];

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        dependencies: deps
      };

      // options from URL query string
      var queryOptions = Reveal.getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
